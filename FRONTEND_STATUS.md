# Chrome拡張機能のフロント実装状況

## 概要

この拡張機能は、Twitter/X.comでの投稿をリアルタイムでチェックし、潜在的に問題のある内容（差別的発言、誹謗中傷など）を検出して警告するためのツールです。ユーザーは設定を通じて、どのような種類の内容をチェックするかをカスタマイズできます。

## プロジェクト構造

```
src/app/
├── fonts/                  # フォントファイル
├── images/                 # 画像アセット
├── pages/                  # HTML ページ
│   ├── popup.html          # ポップアップUI
│   └── sidebar.html        # サイドパネルUI
├── scripts/                # TypeScriptファイル
│   ├── background.ts       # バックグラウンドスクリプト
│   ├── content.ts          # コンテンツスクリプト
│   ├── popup.ts            # ポップアップスクリプト
│   └── sidebar.ts          # サイドパネルスクリプト
├── styles/                 # CSSファイル
│   ├── popup.css           # ポップアップスタイル
│   └── sidebar.css         # サイドパネルスタイル
├── _locales/               # 多言語対応ファイル
└── manifest.json           # 拡張機能の設定ファイル
```

## コンポーネント詳細

### 1. マニフェスト (manifest.json)

拡張機能の設定ファイルで、以下の主要な設定が含まれています：

- Manifest V3を使用
- ポップアップUI (popup.html)
- バックグラウンドサービスワーカー (background.js)
- サイドパネル (pages/sidebar.html)
- Twitter/X.comで動作するコンテンツスクリプト (content.js)
- ストレージとサイドパネルの権限

### 2. コンテンツスクリプト (content.ts)

Twitter/X.comのページで実行され、以下の機能を提供します：

- ページ内のツイートデータ（テキスト、画像、動画など）を抽出
- ツイート投稿フォームに「チェック」ボタンを追加（インラインツールバーと通常ツールバーの両方）
- 「チェック」ボタンがクリックされると、投稿中のツイートデータを取得してバックグラウンドスクリプトに送信
- ツイートの種類（通常ツイート、リツイート、引用ツイート）を識別
- 動画URLの取得（oEmbed経由）

主な実装：

- MutationObserverを使用してDOMの変更を監視し、ツイート投稿フォームが表示されたときに「チェック」ボタンを追加
- ツイートデータを抽出するための詳細なDOM操作
- バックグラウンドスクリプトとのメッセージング

### 3. バックグラウンドスクリプト (background.ts)

拡張機能のバックグラウンドで動作し、以下の機能を提供します：

- 拡張機能の設定を管理（ストレージへの保存と取得）
- サイドパネルの動作を制御
- コンテンツスクリプトからのメッセージを処理
- oEmbedデータを取得して動画URLを抽出

主な実装：

- 拡張機能のインストール時に初期設定を作成
- 設定の取得と更新のためのメッセージハンドラ
- ツイートURLからoEmbedデータを取得するためのフェッチ処理
- サイドパネルを開くためのAPI呼び出し

### 4. ポップアップUI (popup.html, popup.ts)

拡張機能のアイコンをクリックしたときに表示されるUIで、以下の機能を提供します：

- 拡張機能の有効/無効を切り替えるトグル
- 禁止事項設定（差別、誹謗中傷、デマなど10種類）のチェックボックス
- 設定の保存と読み込み
- 空画面と設定画面の切り替え

主な実装：

- 設定画面と空画面の2つのビュー
- バックグラウンドスクリプトとのメッセージングによる設定の管理
- ステータスメッセージの表示（成功/エラー）

### 5. サイドパネルUI (sidebar.html, sidebar.ts)

ブラウザのサイドパネルに表示されるUIで、以下の機能を提供します：

- ツイートの警告を表示（危険度、問題点、該当テキストなど）
- 拡張機能の設定を管理（ポップアップUIと同様）
- 警告一覧と設定画面の切り替え
- テスト用の警告追加ボタン

主な実装：

- 警告要素の動的な生成と表示
- アニメーション効果を使用した警告の表示
- バックグラウンドスクリプトとのメッセージングによる設定の管理
- ビューの切り替え機能

## データフロー

1. ユーザーがTwitter/X.comでツイートを作成し、「チェック」ボタンをクリック
2. コンテンツスクリプトがツイートデータを収集し、バックグラウンドスクリプトに送信
    - 送信されるデータ形式（TweetData）:
      ```typescript
      {
        type: "tweet",                // ツイートの種類（常に "tweet"）
        user: null,                   // ユーザー名（投稿前のため null）
        text: "ツイートの本文",        // 入力されたテキスト
        datetime: "2023-...",         // 現在のタイムスタンプ（ISO形式）
        url: null,                    // ツイートURL（投稿前のため null）
        images: ["data:image/..."],   // 添付画像（Base64エンコード）
        video: "blob:..."             // 添付動画（blobURL）
      }
      ```
3. バックグラウンドスクリプトがサイドパネルを開き、ツイートデータを転送
4. サイドパネルが警告を表示（将来的にはAI分析を追加予定）
    - 現在は内容に関わらず固定の警告を表示（危険度「高」、問題点「不適切な内容」）
5. ユーザーは警告を確認し、必要に応じてツイート内容を修正

## 現在の実装状況

- ✅ 基本的なUI（ポップアップ、サイドパネル）
- ✅ 設定の保存と読み込み
- ✅ Twitter/X.comでのツイートデータ抽出
- ✅ 「チェック」ボタンの追加
- ✅ 警告の表示機能
- ⚠️ 実際のAI分析は未実装
    - 現在はチェックボタンが押されると、ツイートの内容に関わらず固定の警告メッセージを表示
    - 警告の危険度は常に「高」と表示され、問題点は「不適切な内容」という一般的な文言のみ
    - 実際のAI分析を行うバックエンドAPIとの連携は未実装
    - 将来的には、ツイートの内容を分析し、特定の問題（差別、誹謗中傷など）を検出して詳細な警告を表示する予定
- ⚠️ 多言語対応は設定されているが、実際の翻訳は未実装

## 今後の開発予定

- AIによるツイート内容の分析機能の実装
- より詳細な警告情報の提供
- ユーザーフィードバックに基づくUI改善
- 多言語対応の完全実装
- パフォーマンス最適化
